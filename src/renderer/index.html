<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' https://akashic-games.github.io; img-src 'self' data: http://127.0.0.1:* https://akashic-games.github.io; media-src 'self' http://127.0.0.1:*; script-src 'self'; style-src 'self' 'unsafe-inline'; frame-src https://akashic-games.github.io http://127.0.0.1:*"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Namagame Creator</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div id="app">
      <header class="app-header">
        <div>
          <h1>Namagame Creator</h1>
          <p>テキストからニコ生ゲームを生成・実行・配布するツール</p>
        </div>
        <div class="update-status" id="updateStatus">更新確認中...</div>
      </header>

      <main>
        <section id="screen-config" class="screen">
          <h2>生成AI設定</h2>
          <p>
            OpenAIのResponses APIを利用してニコ生ゲームを自動生成します。<br />
            利用にはAPIキーが必要です。入力されたキーはアプリ内でのみ利用します。
          </p>

          <div class="form-grid">
            <label for="designModelSelect">設計モデル</label>
            <select id="designModelSelect"></select>

            <label for="modelSelect">実装モデル</label>
            <select id="modelSelect"></select>

            <label for="apiKeyInput">APIキー</label>
            <input
              id="apiKeyInput"
              type="password"
              placeholder="sk-..."
              autocomplete="off"
            />
          </div>

          <div id="configModelWarning" class="warning hidden"></div>
          <button id="configSubmit" class="primary">決定</button>
          <div id="configError" class="error"></div>
        </section>

        <section id="screen-generate" class="screen hidden">
          <h2>ゲーム生成</h2>
          <p>
            ゲームの内容・仕様をテキストで入力し、「ゲーム生成」を押してください。<br />
            生成が完了するとゲーム実行画面へ移動します。
          </p>

          <div class="option-block">
            <div class="option-group design-options" id="designOptionsGenerate">
              <label class="checkbox">
                <input id="useDesignModelGenerate" type="checkbox" checked />
                ゲーム設計モデルを利用
              </label>
                <div class="option-row">
                  <label for="designTempGenerate">ゲームデザイン温度</label>
                  <div class="temp-control">
                  <span class="temp-label">厳格</span>
                  <input
                    id="designTempGenerate"
                    type="range"
                    class="temp-range"
                    min="0"
                    max="1"
                    step="0.05"
                    value="1"
                  />
                  <span class="temp-label">独創</span>
                  <span id="designTempGenerateValue" class="temp-value">0.30</span>
                </div>
              </div>
            </div>
            <label class="checkbox">
              <input id="forbidGameJsonGenerate" type="checkbox" />
              game.json の更新を禁止
            </label>
          </div>

          <div class="project-import">
            <div class="project-import-header">
              <h3>既存のプロジェクトの読み込み</h3>
              <button id="openProjectButton" class="ghost">フォルダを選択</button>
            </div>
          </div>

          <div id="historyGenerate" class="history"></div>

          <textarea
            id="generatePrompt"
            placeholder="例: 2分間でスコアを稼ぐクリックゲーム。ランキング対応。"
          ></textarea>

          <div class="button-row">
            <button id="generateButton" class="primary">ゲーム生成</button>
            <button id="goToConfigGenerate" class="ghost">API設定へ</button>
          </div>
          <div id="generateError" class="error"></div>
        </section>

        <section id="screen-play" class="screen hidden">
          <div class="screen-row">
            <div>
              <h2>ゲーム実行</h2>
              <p>
                生成されたニコ生ゲームを試遊できます。<br />
                右側の入力欄から「ゲーム修正」で再生成できます。
              </p>
              <p class="note">
                ゲームに問題が発生した場合は、以下のリンクからゲームデバッグページを開き、
                DevToolsで詳細を確認してください。
              </p>
              <a id="playgroundLink" class="link" href="#" target="_blank" rel="noreferrer">
                デバッグ画面を開く
              </a>
              <!-- <div class="debug-open-row">
                <label for="debugOpenMode">開き方</label>
                <select id="debugOpenMode">
                  <option value="app">アプリ内</option>
                  <option value="external">外部ブラウザ</option>
                </select>
              </div> -->
            </div>
            <div class="split-button" id="downloadSplit">
              <button id="downloadMain" class="primary">ニコ生ゲームをダウンロード</button>
              <button id="downloadToggle" class="ghost">▼</button>
              <div id="downloadMenu" class="menu hidden">
                <button data-download="nicolive">ニコ生ゲーム</button>
                <button data-download="project">プロジェクト</button>
              </div>
            </div>
          </div>

          <div class="play-layout">
            <div class="game-frame">
              <iframe
                id="playgroundFrame"
                title="Nicolive Game"
              ></iframe>
              <div id="gamePlaceholder" class="placeholder">
                ゲームがここに表示されます。
              </div>
            </div>

            <div class="side-panel">
              <div id="historyModify" class="history"></div>
              <div class="option-block">
                <div class="option-group design-options" id="designOptionsModify">
                  <label class="checkbox">
                    <input id="useDesignModelModify" type="checkbox" checked />
                    ゲーム設計モデルを利用
                  </label>
                  <div class="option-row">
                    <label for="designTempModify">ゲームデザイン温度</label>
                    <div class="temp-control">
                      <span class="temp-label">厳格</span>
                      <input
                        id="designTempModify"
                        type="range"
                        class="temp-range"
                        min="0"
                        max="1"
                        step="0.05"
                        value="1"
                      />
                      <span class="temp-label">独創</span>
                      <span id="designTempModifyValue" class="temp-value">0.30</span>
                    </div>
                  </div>
                </div>
                <label class="checkbox">
                  <input id="forbidGameJsonModify" type="checkbox" />
                  game.json の更新を禁止
                </label>
              </div>
              <label for="modifyPrompt">ゲーム修正テキスト</label>
              <textarea
                id="modifyPrompt"
                placeholder="改善したい点や追加したい要素を記述してください。"
              ></textarea>
              <div class="button-row">
                <button id="modifyButton" class="primary">ゲーム修正</button>
              </div>
              <div class="button-row">
                <button id="returnToGenerate" class="ghost">生成画面へ戻る</button>
              </div>
              <button id="goToConfig" class="ghost hidden">API設定へ</button>
              <div id="modifyError" class="error"></div>
            </div>
          </div>
        </section>
      </main>

      <div id="loadingOverlay" class="loading hidden">
        <div class="spinner"></div>
        <div id="loadingText">生成中...</div>
        <button id="cancelGeneration" class="cancel hidden">キャンセル</button>
      </div>
    </div>

    <script type="module" src="./index.js"></script>
  </body>
</html>
